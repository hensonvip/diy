{include file="pageheader.htm"}
<form action="attribute.php"  method="post" name="theForm" onsubmit="return validate();" class="layui-form layui-form-pane">
<div class="layui-tab-content">
    <div class="layui-tab-item layui-show">
        <!--属性名称-->
        <div class="layui-form-item">
            <label class="layui-form-label">{$lang.require_field} {$lang.label_attr_name}</label>
            <div class="layui-input-block">
                <input class="layui-input" type="text" placeholder="请输入属性名称" autocomplete="off" name="attr_name" value="{$attr.attr_name}" >
            </div>
        </div>
        <!--属性表单名称-->
        <!-- <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticelinked');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                {$lang.require_field} 属性表单名称
            </label>
            <div class="layui-input-block">
                <input class="layui-input" type="text" placeholder="请输入属性表单名称" autocomplete="off" name="attr_form_name" value="{$attr.attr_form_name}" >
                <br/><br/><span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticelinked">属性表单名称必须为英文字符串</span>
            </div>
        </div> -->
        <!--所属商品类型-->
        <div class="layui-form-item">
            <label class="layui-form-label">{$lang.require_field} {$lang.label_cat_id}</label>
            <div class="layui-input-block">
                <select name="cat_id" lay-filter="sel_cat_id">
                    <option value="0">{$lang.select_please}</option>
                    {$goods_type_list}
                </select>
            </div>
        </div>
        <!--是否diy属性-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticelinked');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                是否diy属性
            </label>
            <div class="layui-input-block">
                <input type="radio" name="is_diy" value="0" {if $attr.is_diy eq 0} checked="true" {/if} title="{$lang.no}" />
                <input type="radio" name="is_diy" value="1" {if $attr.is_diy eq 1} checked="true" {/if} title="{$lang.yes}" />
                <br/><br/><span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticelinked">diy属性会在设计页面显示</span>
            </div>
        </div>
        <!--属性分组-->
        <div class="layui-form-item" id="attrGroups" style="display:none">
            <label class="layui-form-label">{$lang.label_attr_group}</label>
            <div class="layui-input-block">
                <select name="attr_group">
                    <option value="0">{$lang.select_please}</option>
                    {if $attr_groups}
                    {html_options options=$attr_groups selected=$attr.attr_group}
                    {/if}
                </select>
            </div>
        </div>
        <!--能否进行检索-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticeindex');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                {$lang.label_attr_index}
            </label>
            <div class="layui-input-block">
                <input type="radio" name="attr_index" value="0" {if $attr.attr_index eq 0} checked="true" {/if} title="{$lang.no_index}" />
                <input type="radio" name="attr_index" value="1" {if $attr.attr_index eq 1} checked="true" {/if} title="{$lang.keywords_index}" />
                <input type="radio" name="attr_index" value="2" {if $attr.attr_index eq 2} checked="true" {/if} title="{$lang.range_index}" />
                <br/><br/><span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticeindex">{$lang.note_attr_index}</span>
            </div>
        </div>
        <!--相同属性值的商品是否关联-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticelinked');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                是否关联
            </label>
            <div class="layui-input-block">
                <input type="radio" name="is_linked" value="0" {if $attr.is_linked eq 0} checked="true" {/if} title="{$lang.no}" />
                <input type="radio" name="is_linked" value="1" {if $attr.is_linked eq 1} checked="true" {/if} title="{$lang.yes}" />
                <br/><br/><span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticelinked">相同属性值的商品是否关联</span>
            </div>
        </div>
        <!--属性是否可选-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticeAttrType');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                {$lang.label_attr_type}
            </label>
            <div class="layui-input-block">
                <input type="radio" name="attr_type" value="0" {if $attr.attr_type eq 0} checked="true" {/if} title="{$lang.attr_type_values[0]}" />
                <input type="radio" name="attr_type" value="1" {if $attr.attr_type eq 1} checked="true" {/if} title="{$lang.attr_type_values[1]}" />
                <input type="radio" name="attr_type" value="2" {if $attr.attr_type eq 2} checked="true" {/if} title="{$lang.attr_type_values[2]}" />
                <br/><br/><span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticeAttrType">{$lang.note_attr_type}</span>
            </div>
        </div>
        <!--该属性值的录入方式-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                {$lang.label_attr_input_type}
            </label>
            <div class="layui-input-block">
                <input type="radio" name="attr_input_type" value="0" {if $attr.attr_input_type eq 0} checked="true" {/if} title="{$lang.text}" lay-filter="sel_input_type0" />
                <input type="radio" name="attr_input_type" value="1" {if $attr.attr_input_type eq 1} checked="true" {/if} title="{$lang.select}" lay-filter="sel_input_type1" />
                <input type="radio" name="attr_input_type" value="2" {if $attr.attr_input_type eq 2} checked="true" {/if} title="{$lang.text_area}" lay-filter="sel_input_type0" />
            </div>
        </div>
        <!--可选值列表-->
        <div class="layui-form-item layui-form-text" id="goods_textarea_box">
            <label class="layui-form-label" style="float:left;">{$lang.label_attr_values}</label>
            <div class="layui-input-initial">
              <textarea class="layui-textarea" name="attr_values" id="goods_brief" style="float:left;width:20%;">{$attr.attr_values}</textarea>
            </div>
        </div>
        <!--是否启用条形码-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                {$lang.label_txm_type}
            </label>
            <div class="layui-input-block">
                <input type="radio" name="attr_txm" value="0" {if $attr.attr_txm eq 0} checked="true" {/if} title="{$lang.no}" />
                <input type="radio" name="attr_txm" value="1" {if $attr.attr_txm eq 1} checked="true" {/if} title="{$lang.yes}" />
            </div>
        </div>
        <!--是否启用属性相册-->
        <div class="layui-form-item">
            <label class="layui-form-label">
                <a href="javascript:showNotice2('noticeAttrGallery');" title="{$lang.form_notice}">
                    <img src="images/notice.gif" width="16" height="16" border="0" alt="{$lang.form_notice}">
                </a>
                启用属性相册
            </label>
            <div class="layui-input-block">
                <input type="radio" name="is_attr_gallery" value="1" {if $attr.is_attr_gallery eq 1 }checked=checked{/if} title="启用">
                <input type="radio" name="is_attr_gallery" value="0" {if $attr.is_attr_gallery eq 0 }checked=checked{/if} title="不启用">
                <span class="notice-span" {if $help_open}style="display:initial" {else} style="display:none" {/if} id="noticeAttrGallery">注意每个商品类型下只能有一个属性被启用“属性相册”</span>
            </div>
        </div>
        <p class="btn_padding_left">
            <input type="hidden" name="act" value="{$form_act}" />
            <input type="hidden" name="attr_id" value="{$attr.attr_id}" />
            <input type="submit" value="{$lang.button_submit}" class="layui-btn"/>
            <input type="reset" value="{$lang.button_reset}" class="layui-btn layui-btn-primary" />
        </p>

    </div>
</div>
</form>

{insert_scripts files="../js/utils.js,validator.js"}
{literal}
<script language="JavaScript">
<!--
onload = function()
{
{/literal}
  radioClicked({$attr.attr_input_type});
  onChangeGoodsType({$attr.cat_id});
  // 开始检查订单
  startCheckOrder();
{literal}
}

/**
 * 检查表单输入的数据
 */
function validate()
{
  var ele = document.forms['theForm'].elements;
  var msg = '';

  if (Utils.trim(ele['attr_name'].value) == '')
  {
    msg += name_not_null + '\n';
  }

  /*if (Utils.trim(ele['attr_form_name'].value) == '')
  {
    msg += '请您输入属性表单名称。' + '\n';
  }*/

  if (ele['cat_id'].value == 0)
  {
    msg += cat_id_not_null + '\n';
  }

  if (ele['attr_input_type'][1].checked && Utils.trim(ele['attr_values'].value) == '')
  {
    msg += values_not_null + '\n';
  }

  if (msg.length > 0)
  {
    alert(msg);
    return false;
  }
  else
  {
    return true;
  }
}

/**
 * 点击类型按钮时切换选项的禁用状态
 */
function radioClicked(n)
{
  document.forms['theForm'].elements["attr_values"].disabled = n > 0 ? false : true;
}

/**
 * 改变商品类型的处理函数
 */
function onChangeGoodsType(catId)
{
  Ajax.call('attribute.php?act=get_attr_groups&cat_id=' + catId, '', changeGoodsTypeResponse, 'GET', 'JSON');
}

function changeGoodsTypeResponse(res)
{
  if (res.error == 0)
  {
    var row = document.getElementById('attrGroups');
    if (res.content.length == 0) {
      row.style.display = 'none';
    } else {
      row.style.display = document.all ? 'block' : 'inline-block';

      var sel = document.forms['theForm'].elements['attr_group'];

      sel.length = 0;

      for (var i = 0; i < res.content.length; i++)
      {
        var opt = document.createElement('OPTION');
        opt.value = i;
        opt.text = res.content[i];
        sel.options.add(opt);
        if (i == '{$attr.attr_group}')
        {
          opt.selected=true;
        }
      }
    }
  }

  if (res.message)
  {
    alert(res.message);
  }
}

//-->
</script>
{/literal}

<script type="text/javascript">
    layui.use('form', function(){
        var form = layui.form(),layer = layui.layer,layedit = layui.layedit,laydate = layui.laydate;
        form.render(); //更新全部
        //监听指定开关
        form.on('select(sel_cat_id)', function(data){
            onChangeGoodsType(data.value);
        });
        form.on('radio(sel_input_type0)', function(data){
            radioClicked(0);
        });
        form.on('radio(sel_input_type1)', function(data){
            radioClicked(1);
        });

    });
</script>
{include file="pagefooter.htm"}
