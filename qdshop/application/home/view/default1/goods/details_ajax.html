<div class="ipro_wrap ipro_wrap_{$goods_id} top" data-id="{$goods_id}">
    <div class="ipro_size">
        <i class="ipro_back"></i>
        <div class="ipro_size_box">
            <img class="lazybg" data-lazyload-img="__IMGPC__/pic12.jpg">
        </div>
    </div>
    <div class="ipro_left">
        <div class="ipro_main pr">
            <ul class="ipro_slick">
                {volist name="data.goods_gallery" id="vo"}
                <li data-id="{$vo.goods_attr_id}{$vo.goods_attr_id2}" class="ipro_zoom"><img class="o_img" src="{$webUrl}{$vo.img_url}"></li>
                {/volist}
            </ul>
            <a class="ipro_main_btn"></a>
            <div class="hover"></div>
        </div>
        <div class="ipro_piclist clearfix">
            {volist name="data.goods_details" id="vo"}
                <div class="box"><img realsrc="{$webUrl}{$vo.original_img}" class="lazybg" data-lazyload-img="{$webUrl}{$vo.original_img}"></div>
            {/volist}
        </div>
        <div class="ipro_zan {if $data.has_zan gt 0}on{/if}">
            <span class="icon"></span>
        </div>
        {include file="public/ipro_share" /}
        <div class="ipro_com">
            <h2>推荐</h2>
            <div class="ipro_com_top change5">
                <ul class="i_plist clearfix">
                    {if $hot.list}
                    {foreach $hot.list as $key => $vo}
                    <li>
                        <div class="before">
                            <div class="clo">
                            <a href="">
                                <img class="lazybg" data-lazyload-img="{$webUrl}{$vo.goods_thumb}">
                            </a>
                            </div>
                            <div class="line"></div>
                            <div class="info">
                                <span class="view">{$vo.click_count}</span>
                                <span class="zan">{$vo.zan}</span>
                            </div>
                        </div>
                        <a href="{:url('Goods/details',array('goods_id'=>$vo.goods_id))}">
                            <div class="after">
                                <div class="af_top tc">
                                    <div class="af_avatar lazybg" data-lazyload-bg="{$webUrl}{$vo.headimg}"></div>
                                    <h3 class="tover">{if $vo.nickname}{$vo.nickname}{else}{$vo.user_name}{/if}</h3>
                                    <h2 class="dot">{$vo.goods_name}</h2>
                                </div>
                                <div class="af_bot tc">
                                    <div class="af_bar"><i style="width: {$vo.number_per}%;"></i></div>
                                    <div class="info">
                                        <h2>￥<em>{$vo.shop_price}</em></h2>
                                        <p>限量 {$vo.goods_number}/{$vo.goods_total}</p>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </li>
                    {/foreach}
                    {/if}
                </ul>
            </div>
            <div class="ipro_com_bot">
                <div class="ipro_com_bot_pf">评论(88)<span class="fr"><font>4.0</font><i class="i_pro_pf i_pro_pf4"></i></span></div>
                <ul class="ipro_com_bot_ul">
                    <li class="clearfix">
                        <div class="ipro_com_icon">
                            <i class="zan">23</i>
                            <i class="favor"></i>
                        </div>
                        <a href=""><div class="ipro_com_avatar lazybg" data-lazyload-bg="__IMGPC__/avatar2.jpg"></div></a>
                        <div class="ipro_com_txt">
                            <h3><a href=""><b>Adam</b></a><span>2017-08-24 19:03:01</span><i class="i_pro_pf i_pro_pf4"></i></h3>
                            <p>设计很时尚！</p>
                        </div>
                    </li>
                    <li class="clearfix">
                        <div class="ipro_com_icon">
                            <i class="zan">23</i>
                            <i class="favor"></i>
                        </div>
                        <a href=""><div class="ipro_com_avatar lazybg" data-lazyload-bg="__IMGPC__/avatar3.jpg"></div></a>
                        <div class="ipro_com_txt">
                            <h3><a href=""><b>Brian</b></a><span>2017-08-24 19:03:01</span><i class="i_pro_pf i_pro_pf4"></i></h3>
                            <p>Nice work！</p>
                        </div>
                    </li>
                </ul>
                <i class="base-load"></i>
            </div>
        </div>
    </div>
    <div class="ipro_right">
        <div class="ipro_right_bef">
            <div class="ipd_rtop">
                <div class="ipd_user clearfix">
                    <div class="avatar">
                        <a href=""><span class="lazybg" data-lazyload-bg="{$webUrl}{$data.headimg}"></span></a>
                        <div class="avatar_box">
                            <div class="avatar_wrap">
                                <div class="ava_top clearfix">
                                    <a href=""><div class="ava_pic lazybg" data-lazyload-bg="{$webUrl}{$data.headimg}"></div></a>
                                    <div class="ava_txt">
                                        <a href=""><h2>{if $data.nickname}{$data.nickname}{else}{$data.user_name}{/if}</h2></a>
                                        <p>设计师</p>
                                    </div>
                                    <a href="javascript:void(0);" class="d_ava_talk nb_t1">私 信</a>
                                </div>
                                <div class="ava_bot">
                                    <ul class="clearfix">
                                        <li><span>T恤作品</span>
                                            <a href=""><font>{$data.t_goods_number}</font></a>
                                        </li>
                                        <li><span>设计作品</span>
                                            <a href=""><font>{$data.t_diy_number}</font></a>
                                        </li>
                                        <li><span>粉丝</span>
                                            <a href=""><font>{$data.fans_number}</font></a>
                                        </li>
                                        <li><span>话题</span>
                                            <a href=""><font>23</font></a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="text">
                        <h2>{if $data.nickname}{$data.nickname}{else}{$data.user_name}{/if}</h2>
                        <span class="guanzhu nb_t2 {if $data.follow_status gt 0}follow followed{else}follow{/if}" user_id="{$data.diy_user_id}" value="{$data.follow_status}">{if $data.follow_status eq 1}已关注{elseif $data.follow_status eq 2 }互相关注{else}关注{/if}</span>
                        <input type="hidden" name="user_id" id="user_id" value="{$data.user_id}">
                        <input type="hidden" name="diy_user_id" id="diy_user_id" value="{$data.diy_user_id}">
                    </div>
                </div>
                <div class="ipd8">
                    <div class="ipd_detail">
                        <h2 id="goods_name">{$data.goods_name}</h2>
                        <div class="price">￥<em>{$data.shop_price}</em></div>
                        <div class="bar"><i style="width: {$data.number_per}%;"></i></div>
                        <p>限量 {$data.goods_number}/{$data.goods_total}</p>
                        <p class="des"><span class="view">{$data.click_count}</span><span class="zan {if $data.has_zan gt 0}on{/if}">{$data.zan}</span><span class="comment">23</span><span class="favor {if $data.has_report gt 0}on{/if}"></span></p>
                    </div>
                    <div class="ipd_info">
                        <div class="box">
                            <h2>类型</h2>
                            <p>{$data.cat_name}</p>
                        </div>
                        <div class="box">
                            <h2>设计描述</h2>
                            <p>{$data.goods_design}</p>
                        </div>
                    </div>
                    <div class="ipd_type">
                        <div class="item clearfix">
                            <span>款式</span>
                            <div class="r_box sex_box">
                                {foreach $data.properties as $spec_key => $spec}
                                    {if $spec.name eq '款式'}
                                        {foreach $spec.values as $attr_key => $attr}
                                        <label data-src='{$webUrl}{$attr.default_icon}' data-srcon='{$webUrl}{$attr.select_icon}' style="background-image: url({$webUrl}{$attr.default_icon});">
                                            <input type="radio" id="spec_value_{$attr.id}" name="spec_0" value="{$attr.id}">
                                        </label>
                                        {/foreach}
                                    {/if}
                                {/foreach}
                            </div>
                        </div>
                        <div class="item clearfix">
                            <span>颜色</span>
                            <div class="r_box color_box">
                                {foreach $data.properties as $spec_key => $spec}
                                    {if $spec.name eq '颜色'}
                                        {foreach $spec.values as $attr_key => $attr}
                                        <label class="white" style="background-color: #{$attr.color_code};">
                                            <input type="radio" id="spec_value_{$attr.id}" name="spec_1" value="{$attr.id}">
                                        </label>
                                        {/foreach}
                                    {/if}
                                {/foreach}
                            </div>
                        </div>
                        <div class="item clearfix">
                            <span>尺码</span>
                            <div class="r_box size_box">
                                <p>
                                    <font class="show_size">参数/尺码表</font>
                                </p>
                                <div>
                                    {foreach $data.properties as $spec_key => $spec}
                                        {if $spec.name eq '尺码'}
                                            {foreach $spec.values as $attr_key => $attr}
                                            <label {if $attr_key eq 0}class="on"{/if}>
                                                <input type="radio" id="spec_value_{$attr.id}" name="spec_2" value="{$attr.id}" {if $attr_key eq 0}checked="checked"{/if}>{$attr.label}
                                            </label>
                                            {/foreach}
                                        {/if}
                                    {/foreach}
                                </div>
                            </div>
                        </div>
                        <div class="item clearfix">
                            <span>数量</span>
                            <div class="r_box">
                                <div class="num_box" data-max="{$data.goods_number}">
                                    <input type="button" value="-" class="btn_m">
                                    <input type="text" name="number" value="1" class="btn_input">
                                    <input type="button" value="+" class="btn_a">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ipd_rbot">
                <div class="ipd_rbot_wrap">
                    <div class="ipd_favar nb_t1 {if $data.is_collected eq 1}active{/if}" onclick="collect({$data.goods_id}, this,'goods_id')" {if $data.is_collected neq 1}style="background: #df3853; color: #fff;"{/if}><i></i>{if $data.is_collected eq 1}已收藏{else}加入收藏{/if}</div>
                    <div class="ipd_cart nb_t2"><i></i>加入购物袋</div>
                    <div class="ipd_exp clearfix">
                        <div class="ipd_exp_txt fl"><span>退货说明</span>
                            <div class="ipd_exp_box">
                                <p>因商品为限量定制产品，如非发错货或质量问题，不支持退换货。</p>
                            </div>
                        </div>
                        <a href="" class="icon fr"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" name="goods_id" value="{$data.goods_id}">
    <script>
        $(function(){
            $('.lazybg').lazyload({d:300,r:250});
            $('.dot').dotdotdot({
                wrap: 'letter',
                watch: 'window'
            });
            $('.ipro_slick').slick({
                autoplay: false,
                draggable: false,
                fade: true
            });
            $('.ipro_zoom').zoombie({ on: 'click' });
            $('.ipro_main li').click(function() {
                if ($('.ipro_main').hasClass('hover')) {
                    $('.ipro_main').removeClass('hover');
                } else {
                    $('.ipro_main').addClass('hover');
                }
            });
            socialShare(".social-share, .share-component");

            // 收藏
            $('.ipd_favar').hover(function() {
                if($(this).hasClass('active')){
                    $(this).html("<i></i>取消收藏").css({
                        background: '#df3853',
                        color: '#fff'
                    });
                    $(this).children('i').css('background', 'url(__IMGPC__/icon24_w.png) center no-repeat');
                }
            },function(){
                if($(this).hasClass('active')){
                    $(this).html("<i></i>已收藏").css({
                        background: 'none',
                        color: '#df3853'
                    });
                }else{
                    $(this).html("<i></i>加入收藏").css({
                        background: '#df3853',
                        color: '#fff'
                    });
                }
            });
        });
        //收藏一个商品
        function collect(goods_id, obj,str){
            // if($(obj).hasClass('disabled')){ return false; }
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            $.ajax({
                type: "get",
                url: "/Goods/collectGoods",
                dataType: 'json',
                data:{goods_id:goods_id,str:str},
                success: function(data){
                    layer.close(index);
                    layer.msg(data.message);
                    if(data.status == 200){
                        if($(obj).hasClass('active')){
                            $(obj).removeClass('active').html("<i></i>加入收藏").css({
                                background: '#df3853',
                                color: '#fff'
                            });
                        } else {
                            $(obj).addClass('active').html("<i></i>已收藏").css({
                                background: 'none',
                                color: '#df3853'
                            });
                        }
                        // location.reload();
                    }
                }
            });
        }
        // 价格统计
        function count_num(){
            var all_total = 0;
            var tit_length = $('.ipd_rtop_clist li').length;
            for(var i = 0; i < tit_length; i++){
                var _this = $('.ipd_rtop_clist li').eq(i);
                var tit_num = _this.find('.num_box .btn_input').val();
                var tit_price = _this.find('.one_price').text();
                var tit_total = tit_num * parseFloat(tit_price);
                if(_this.hasClass('selected')){
                    all_total += tit_total;
                }
            }
            $('.ipd_rbot_wrap em').text(formatNum(all_total.toFixed(2)));
        }
        
        // 购物车商品数量
        function count_cart_num(){
            var all_total = 0;
            var tit_length = $('.ipd_rtop_clist li').length;
            for(var i = 0; i < tit_length; i++){
                var _this = $('.ipd_rtop_clist li').eq(i);
                var tit_num = _this.find('.num_box .btn_input').val();
                all_total += parseInt(tit_num);
            }
            $('.header .state .cart').text(all_total);
        }
        //添加商品数量
        function add_num(rec_id,goods_id,supp_id,obj){
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            //获取选中的值
            var sel_goods = new Array();
            $('.ipd_rtop_clist').find("input[name='rec_id']:checked").each(function(){
                sel_goods.push($(this).val());
            });

            var number = parseInt($(obj).parents('.num_box').find('.btn_input').val());
            number++;

            $.ajax({
                type: "post",
                url: "{:url('Cart/updateCart')}",
                dataType: 'json',
                data:{sel_goods:sel_goods,rec_id:rec_id,number:number,goods_id:goods_id,suppid:supp_id},
                success: function(result){
                    layer.close(index);
                    if(result.code == 200){
                        var num = parseInt($(obj).parents('.num_box').find('.btn_input').val());
                        num++;
                        $(obj).parents('.num_box').find('.btn_input').val(num);
                        count_num();
                        count_cart_num();
                    } else {
                        layer.msg(result.message);
                    }
                }
            });
            //禁止页面刷新
            return false;
        }
        //减少商品数量
        function minus_num(rec_id,goods_id,supp_id,obj){
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            //获取选中的值
            var sel_goods = new Array();
            $('.bag_list_one').find("li input[name='rec_id']:checked").each(function(){
                sel_goods.push($(this).val());
            });

            var number = parseInt($(obj).parents('.num_box').find('.btn_input').val());
            if (parseInt(number) <= 1 || number == "") {
                number = 1;
            } else {
                number--;
            }
            $.ajax({
                type: "post",
                url: "{:url('Cart/updateCart')}",
                dataType: 'json',
                data:{sel_goods:sel_goods,rec_id:rec_id,number:number,goods_id:goods_id,suppid:supp_id},
                success: function(result){
                    layer.close(index);
                    if(result.code == 200){
                        var num = parseInt($(obj).parents('.num_box').find('.btn_input').val());
                        if (parseInt(num) <= 1 || num == "") {
                            num = 1;
                        } else {
                            num--;
                        }
                        $(obj).parents('.num_box').find('.btn_input').val(num);
                        count_num();
                        count_cart_num();
                    } else {
                        layer.msg(result.message);
                    }
                }
            });
            //禁止页面刷新
            return false;
        }
        //更新购物车
        function change_price(rec_id,goods_id,supp_id,obj) {
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            var number = parseInt($(obj).val());
            var re_num = /^[0-9]*$/;
            if (!number || !re_num.test(number) || number <= 1) {
                number = 1;
            }
            $(obj).val(number);
            $.ajax({
                type: "post",
                url: "{:url('Cart/updateCart')}",
                dataType: 'json',
                data:{rec_id:rec_id,number:number,goods_id:goods_id,suppid:supp_id},
                success: function(result){
                    layer.close(index);
                    if(result.code == 200){
                        count_num();
                        count_cart_num();
                    } else {
                        layer.msg(result.message);
                    }
                }
            });
            //禁止页面刷新
            return false;
        }
        // 删除购物车一个商品
        function delOne(rec_id, obj){
            $('.dc_pr').removeClass('dc_show');
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            $.ajax({
                type: "get",
                url: "{:url('Cart/deleteCart')}",
                dataType: 'json',
                data:{rec_id:rec_id},
                success: function(data){
                    layer.close(index);
                    if(data.code == 200){
                        $(obj).parents('li').remove();
                        count_num();
                        count_cart_num();
                    } else {
                        layer.msg(data.message);
                    }
                }
            });
        }
        //提交结算
        function checkout(){
            var index = layer.load(0, {
                shade: [0.1,'#fff']
            });
            //获取选中的值
            var sel_goods = new Array();
            $('.ipd_rtop_clist').find("input[name='rec_id']:checked").each(function(){
                sel_goods.push($(this).val());
            });
            if(sel_goods == ''){
                layer.msg('请选择商品！');
                layer.close(index);
                return false;
            }
            location.href = "{:url('Goods/checkout')}"+'?sel_goods='+sel_goods;
            layer.close(index);
        }
    </script>
</div>